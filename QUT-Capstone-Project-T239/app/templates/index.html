{% extends 'base.html' %}

{% block content %}
  <!-- Recent Sports Techs -->

  <!-- <main role="main" aria-label="Home Page"> -->

    <div class="video-header">
      <video autoplay muted loop id="bg-video">
        <source src="../static/img/video.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
      <div class="video-overlay">
        <h1>The Sports Tech</h1>
        <h3>Exploring The Sports Tech products</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
        tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
        quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
        consequat.</p>
        <a href="#row1" class="cta-button">Start Shopping</a>
      </div>
    </div>


    
    <!-- Created Products Display -->
    <section class="Recent" aria-labelledby="recent-products-section">
      <h1 id="recent-products-section">Recently Added Products</h1>
      <p>Check out the 9 latest additions to our shop.</p>
      <div class="product-container">
        <div class="product-grid">
          {% for product in products %}
            <div class="product-card">
              <a href="{{ url_for('product.show', id=product.id) }}">
                <img src="{{ product.image }}" class="product-image" />
              </a>
              <div class="product-info">
                <h3>{{ product.name }}</h3>
                <p>${{ "%.2f"|format(product.price) }}</p>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </section>


    <!-- This is for browsing all available products-->
    <section class="all-products-section" id="all-products">
      <h2>All Products</h2>
      <p>Browse through all available products. Use the filters to narrow down your search.</p>
  
      <!-- Filters -->
      <div class="filters">
          <!-- Category Filter -->
          <select id="category-filter" class="form-select" aria-label="Filter by category">
              <option value="" selected>All Categories</option>
              {% for category in categories %}
              <option value="{{ category }}">{{ category }}</option>
              {% endfor %}
          </select>
  
          <!-- Price Filter -->
          <select id="price-filter" class="form-select" aria-label="Filter by price range">
              <option value="" selected>All Prices</option>
              <option value="0-50">Under $50</option>
              <option value="50-100">$50 - $100</option>
              <option value="100-200">$100 - $200</option>
              <option value="200+">Above $200</option>
          </select>
      </div>
  
      <!-- Product Grid -->
      <div class="product-grid">
          {% for product in products %}
          <a href="/products/{{ product.id }}" class="product-card-link">
              <div class="product-card">
                  <img src="{{ product.image }}" alt="{{ product.name }}" class="img-fluid" />
                  <h3>{{ product.name }}</h3>
                  <p>Price: ${{ product.price }}</p>
                  <p>Category: {{ product.category }}</p>
              </div>
          </a>
          {% endfor %}
      </div>
  </section>
  

    <!-- Contact HTML -->
    <!-- deleted the browse here -->
    <section class="contact-section" id="contact">
      <h2>Contact Us</h2>
      <p>Do you have any lingering question if so dont hestitate to contact us, 
        we will get back to us as soon as possible <3</p>
      <form action="/contact" method="POST" class="contact-form">
        <input type="text" name="name" placeholder="Your Name" required />
        <input type="email" name="email" placeholder="Your Email" required />
        <textarea name="message" rows="5" placeholder="Your Message" required></textarea>
        <button type="submit">Send Message</button>
      </form>
    </section>
  </main>
  
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const categoryFilter = document.getElementById('category-filter');
      const priceFilter = document.getElementById('price-filter');
      const productCards = document.querySelectorAll('.product-card');
  
      function filterProducts() {
        const selectedCategory = categoryFilter.value.toLowerCase().trim();
        const selectedPrice = priceFilter.value;
  
        productCards.forEach(card => {
          const productCategory = card.querySelector('p:nth-child(4)').textContent.replace('Category: ', '').toLowerCase().trim();
          const productPrice = parseFloat(card.querySelector('p:nth-child(3)').textContent.replace('Price: $', ''));
  
          let isVisible = true;
  
          // Filter by category
          if (selectedCategory && productCategory !== selectedCategory) {
            isVisible = false;
          }
  
          // Filter by price
          if (selectedPrice) {
            const [min, max] = selectedPrice.includes('+') ? [parseFloat(selectedPrice), null] : selectedPrice.split('-').map(Number);
            if (max) {
              // If max exists, filter within the range
              if (productPrice < min || productPrice > max) {
                isVisible = false;
              }
            } else {
              // If no max, filter for prices above min
              if (productPrice < min) {
                isVisible = false;
              }
            }
          }
  
          // Show or hide the product card
          card.style.display = isVisible ? 'block' : 'none';
        });
  
        // Dynamically update the grid layout
        const productGrid = document.querySelector('.product-grid');
        const visibleCards = Array.from(productCards).filter(card => card.style.display === 'block');
        productGrid.innerHTML = ''; // Clear the grid
        visibleCards.forEach(card => productGrid.appendChild(card)); // Re-add visible cards
      }
  
      categoryFilter.addEventListener('change', filterProducts);
      priceFilter.addEventListener('change', filterProducts);
    });
  </script>
{% endblock %}
